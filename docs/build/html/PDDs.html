

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using PDDs &mdash; average-minimum-distance 1.2.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="_static/dark_mode_js/default_light.js"></script>
        <script src="_static/dark_mode_js/theme_switcher.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Miscellaneous" href="miscellaneous.html" />
    <link rel="prev" title="Using AMDs" href="AMDs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> average-minimum-distance
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Common tasks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="reading%20cifs.html">Reading .CIFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading%20from%20CSD.html">Reading from the CSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMDs.html">Using AMDs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using PDDs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#calculating-pdds">Calculating PDDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calculation-options">Calculation options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comparing-by-pdd">Comparing by PDD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comparison-options">Comparison options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous.html">Miscellaneous</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="amd.calculate.html">amd.calculate module</a></li>
<li class="toctree-l1"><a class="reference internal" href="amd.compare.html">amd.compare module</a></li>
<li class="toctree-l1"><a class="reference internal" href="amd.io.html">amd.io module</a></li>
<li class="toctree-l1"><a class="reference internal" href="amd.periodicset.html">amd.periodicset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="amd.utils.html">amd.utils module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">average-minimum-distance</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using PDDs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/PDDs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-pdds">
<h1>Using PDDs<a class="headerlink" href="#using-pdds" title="Permalink to this headline">¶</a></h1>
<div class="section" id="calculating-pdds">
<h2>Calculating PDDs<a class="headerlink" href="#calculating-pdds" title="Permalink to this headline">¶</a></h2>
<p>The PDD (pointwise distance distribution) of a crystal is given by <code class="docutils literal notranslate"><span class="pre">amd.PDD()</span></code>.
It accepts a crystal and an integer k, returning the <span class="math notranslate nohighlight">\(\text{PDD}_k\)</span> as a matrix
with k+1 columns, the weights of each row being in the first column.</p>
<p>If you have a .cif file, use <code class="xref py py-class docutils literal notranslate"><span class="pre">amd.CifReader</span></code> to read the crystals. If
<code class="docutils literal notranslate"><span class="pre">csd-python-api</span></code> is installed and you have CSD refcodes, use <code class="xref py py-class docutils literal notranslate"><span class="pre">amd.CSDReader</span></code>.
You can also give the coordinates of motif points and unit cell as a tuple of numpy
arrays, in Cartesian form. Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get PDDs of crystals in a .cif</span>
<span class="n">crystals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">amd</span><span class="o">.</span><span class="n">CifReader</span><span class="p">(</span><span class="s1">&#39;file.cif&#39;</span><span class="p">))</span>
<span class="n">pdds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">crystal</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">crystal</span> <span class="ow">in</span> <span class="n">crystals</span><span class="p">]</span>

<span class="c1"># get PDDs of crystals in DEBXIT family</span>
<span class="n">pdds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">crystal</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">crystal</span> <span class="ow">in</span> <span class="n">amd</span><span class="o">.</span><span class="n">CSDReader</span><span class="p">(</span><span class="s1">&#39;DEBXIT&#39;</span><span class="p">,</span> <span class="n">families</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>

<span class="c1"># PDD of 3D cubic lattice</span>
<span class="n">motif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">cell</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">cubic_pdd</span> <span class="o">=</span> <span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">((</span><span class="n">motif</span><span class="p">,</span> <span class="n">cell</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Each PDD returned by <code class="docutils literal notranslate"><span class="pre">amd.PDD(c,</span> <span class="pre">k)</span></code> is a matrix with <code class="docutils literal notranslate"><span class="pre">k+1</span></code> columns.</p>
<div class="section" id="calculation-options">
<h3>Calculation options<a class="headerlink" href="#calculation-options" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd.PDD</span></code> accepts a few optional arguments (not relevant to <code class="docutils literal notranslate"><span class="pre">amd.AMD</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">periodic_set</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collapse_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">order</span></code> lexicograpgically orders the rows of the PDD, and <code class="docutils literal notranslate"><span class="pre">collapse</span></code> merges rows
if all the elements are within <code class="docutils literal notranslate"><span class="pre">collapse_tol</span></code>. The technical definition of PDD
requires doing both in order for PDD to satisfy invariance, but sometimes it’s useful to
disable the behaviours, particularly so that the PDD rows are in the same order as the
passed motif points. Without ordering and collapsing, isometric inputs could give different
PDDs; but the Earth mover’s distance between the PDDs would still be 0.</p>
</div>
</div>
<div class="section" id="comparing-by-pdd">
<h2>Comparing by PDD<a class="headerlink" href="#comparing-by-pdd" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Earth_mover%27s_distance">Earth mover’s distance</a> is
an appropriate metric to compare PDDs, and the <a class="reference internal" href="amd.compare.html#module-amd.compare" title="amd.compare"><code class="xref py py-mod docutils literal notranslate"><span class="pre">amd.compare</span></code></a> module has functions
for these comparisons.</p>
<p>Most useful are <a class="reference internal" href="amd.compare.html#amd.compare.PDD_pdist" title="amd.compare.PDD_pdist"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.PDD_pdist()</span></code></a> and <a class="reference internal" href="amd.compare.html#amd.compare.PDD_cdist" title="amd.compare.PDD_cdist"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.PDD_cdist()</span></code></a>, which mimic
the interface of scipy’s functions <code class="docutils literal notranslate"><span class="pre">pdist</span></code> and <code class="docutils literal notranslate"><span class="pre">cdist</span></code>. <code class="docutils literal notranslate"><span class="pre">pdist</span></code> takes one set and
compares all elements pairwise, whereas <code class="docutils literal notranslate"><span class="pre">cdist</span></code> takes two sets and compares elements in
one with the other. <code class="docutils literal notranslate"><span class="pre">cdist</span></code> returns a 2D distance matrix, but <code class="docutils literal notranslate"><span class="pre">pdist</span></code> returns a
condensed distance matrix (see <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html">scipy’s pdist function</a>).
The default metric for AMD comparisons is l-infinity, but it can be changed to any metric
accepted by scipy’s pdist/cdist.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare crystals in file1.cif with those in file2.cif by PDD, k=100</span>
<span class="n">pdds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">crystal</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">crystal</span> <span class="ow">in</span> <span class="n">amd</span><span class="o">.</span><span class="n">CifReader</span><span class="p">(</span><span class="s1">&#39;file1.cif&#39;</span><span class="p">)]</span>
<span class="n">pdds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">crystal</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">crystal</span> <span class="ow">in</span> <span class="n">amd</span><span class="o">.</span><span class="n">CifReader</span><span class="p">(</span><span class="s1">&#39;file2.cif&#39;</span><span class="p">)]</span>
<span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">amd</span><span class="o">.</span><span class="n">PDD_cdist</span><span class="p">(</span><span class="n">pdds1</span><span class="p">,</span> <span class="n">pdds2</span><span class="p">)</span>

<span class="c1"># compare everything in file1.cif with each other</span>
<span class="n">condensed_dm</span> <span class="o">=</span> <span class="n">amd</span><span class="o">.</span><span class="n">PDD_pdist</span><span class="p">(</span><span class="n">pdds1</span><span class="p">)</span>
</pre></div>
</div>
<p>You can compare one PDD with another with <a class="reference internal" href="amd.compare.html#amd.compare.emd" title="amd.compare.emd"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.emd()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare DEBXIT01 and DEBXIT02 by PDD, k=100</span>
<span class="n">pdds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amd</span><span class="o">.</span><span class="n">PDD</span><span class="p">(</span><span class="n">crystal</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">crystal</span> <span class="ow">in</span> <span class="n">amd</span><span class="o">.</span><span class="n">CSDReader</span><span class="p">([</span><span class="s1">&#39;DEBXIT01&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBXIT02&#39;</span><span class="p">])]</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">amd</span><span class="o">.</span><span class="n">emd</span><span class="p">(</span><span class="n">pdds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p><a class="reference internal" href="amd.compare.html#amd.compare.emd" title="amd.compare.emd"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.emd()</span></code></a>, <a class="reference internal" href="amd.compare.html#amd.compare.PDD_pdist" title="amd.compare.PDD_pdist"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.PDD_pdist()</span></code></a> and <a class="reference internal" href="amd.compare.html#amd.compare.PDD_cdist" title="amd.compare.PDD_cdist"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare.PDD_cdist()</span></code></a> all accept
an optional argument <code class="docutils literal notranslate"><span class="pre">metric</span></code>, which can be anything accepted by <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html">scipy’s pdist/cdist functions</a>.
The metric used to compare PDD matrices is always Earth mover’s distance, but this still requires another metric
between the rows of PDDs (so there’s a different Earth mover’s distance for each choice of metric).</p>
<div class="section" id="comparison-options">
<h3>Comparison options<a class="headerlink" href="#comparison-options" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd.PDD_cdist</span></code> and <code class="docutils literal notranslate"><span class="pre">amd.PDD_pdist</span></code> share the following optional arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metric</span></code> chooses the metric used for comparison of PDD rows, as explained above. See scipy’s cdist/pdist for a list of accepted metrics.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k</span></code> will truncate the passed PDDs to length <code class="docutils literal notranslate"><span class="pre">k</span></code> before comaparing (so <code class="docutils literal notranslate"><span class="pre">k</span></code> must not be larger than the passed PDDs). Useful if comparing for several <code class="docutils literal notranslate"><span class="pre">k</span></code> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code> (default <code class="docutils literal notranslate"><span class="pre">False</span></code>) prints an ETA to the terminal.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="miscellaneous.html" class="btn btn-neutral float-right" title="Miscellaneous" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="AMDs.html" class="btn btn-neutral float-left" title="Using AMDs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Daniel Widdowson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>